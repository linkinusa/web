var $=require("common:widget/lib/gmu/zepto/zepto.js"),validator=require("common:widget/ui/validator/validator.js").getInstance();$(function(){function t(){e()}function e(){$("#j-title").on("tap","div",function(t){var e=$(t.target);if(!e.hasClass("active")){var a=e.index();$("#j-title>div").removeClass("active"),e.addClass("active"),$(".j-content").removeClass("active").eq(a).addClass("active")}}),$(".j-input").on("input focus",function(t){var e=$(t.target),a=e.next("i");""==e.val()?a.removeClass("clean"):a.addClass("clean")}),a(),$("#changeImageCode").on("click",function(){a()}),$("#codeImg").on("click",function(){a()}),$(".j-clear-input").on("tap",function(t){var e=$(t.target),a=e.prev("input");a.val(""),e.removeClass("clean")}),$("#j-login-btn").on("click",function(){var t=$("#j-title .active").index(),e=$(".j-content").eq(t);0==t?n(e,function(t,e){var a=!0;return validator.validate({email:t.name})||validator.validate({phone:t.name})?t.passwd.length<6&&(a=!1,e.html("您输入的密码格式有误")):(a=!1,e.html("您输入的账号格式有误")),a}):1==t&&n(e,function(t,e){var a=!0;return validator.validate({phone:t.mobile})?validator.validate({smscode:t.code})||(a=!1,e.html("请正确填写验证码")):(a=!1,e.html("请输入正确的手机号")),a})}),$("#j-getphonecode").on("tap",function(t){var e=$(t.target);if(!e.attr("disabled")){var a="/webapp/user/loginsmscode",n=e.closest(".j-content"),o=$(".j-err-wrap",n),r=e.parent().find(".j-input").val(),l=!0;o.html(""),validator.validate({phone:r})||(l=!1,o.html("请输入正确的手机号"));var c={mobile:r};l&&(e.attr("disabled","disabled"),$.post(a,c,function(t,a){if("success"===a){var n=t.errno,r=t.msg;0==n?i(60,e):(o.html(r),e.removeAttr("disabled"))}else o.html("网络错误，请重试"),e.removeAttr("disabled")},"json"))}})}function a(){$.ajax({url:"/webapp/user/loginimagecode",dataType:"json",success:function(t){var e=t.vcode_str,a=t.imgurl;$("#codeImg").attr("src",a),$("#codeStr").val(e)}})}function n(t,e){var a=$(".j-err-wrap",t),n=t.serializeObj();a.html(""),e(n,a)&&t.submit()}function i(t,e){var t=t||30,a=function(){--t>0?(e.html(t+"秒后重发"),setTimeout(a,1e3)):e.removeAttr("disabled").html("获取验证码")};setTimeout(a,1e3)}t()});